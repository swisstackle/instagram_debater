app = "instagram-debater"
primary_region = "iad"

[build]
  dockerfile = "Dockerfile"

# Define process groups and their commands (supersede Docker CMD)
[processes]
  webhook   = "/opt/venv/bin/python run_webhook.py"
  dashboard = "/opt/venv/bin/python dashboard.py"
  # worker = ".venv/bin/python main.py"   # uncomment if/when you want it

# Service 1: Public site (80/443) → webhook on internal 8080
[[services]]
  processes = ["webhook"]
  internal_port = 8080
  protocol = "tcp"

  [[services.ports]]
    handlers = ["http"]
    port = 80
    force_https = true

  [[services.ports]]
    handlers = ["tls","http"]
    port = 443

# Service 2: Dashboard → external 8000 → internal 8081
# If you need IPv4 access on port 8000 using the shared IPv4, include "tls".
[[services]]
  processes = ["dashboard"]
  internal_port = 8081
  protocol = "tcp"

  [[services.ports]]
    # For best reachability on shared IPv4, prefer TLS termination:
    handlers = ["tls","http"]
    port = 8000

[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory = "1gb"
